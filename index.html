<input type="file" id="imageInput" />
<br />
가로 줄 수: <input type="number" id="rows" value="1" />
세로 줄 수: <input type="number" id="cols" value="1" />
<button id="applyBtn">그리드 적용</button>
<button id="downloadBtn">이미지 다운로드</button>
<br /><br />

<canvas id="canvas"></canvas>

<script>
const imageInput = document.getElementById("imageInput");
const applyBtn = document.getElementById("applyBtn");
const downloadBtn = document.getElementById("downloadBtn");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let loadedImage = null; // ⭐ 이미지 캐싱

imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  const img = new Image();

  img.onload = () => {
    loadedImage = img;
    canvas.width = img.width;
    canvas.height = img.height;
    redraw();
  };

  img.src = URL.createObjectURL(file);
});

// 버튼 클릭 시 재반영
applyBtn.addEventListener("click", () => {
  if (!loadedImage) return;
  redraw();
});

downloadBtn.addEventListener("click", () => {
  if (!loadedImage) return;

  const link = document.createElement("a");
  link.download = "grid_image.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});

function redraw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(loadedImage, 0, 0);
  drawGrid();
}

function drawGrid() {
  const rows = Number(document.getElementById("rows").value) + 1;
  const cols = Number(document.getElementById("cols").value) + 1;

  ctx.strokeStyle = "red";
  ctx.lineWidth = 1;

  // 가로선
  for (let i = 1; i < rows; i++) {
    const y = (canvas.height / rows) * i;
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
  }

  // 세로선
  for (let i = 1; i < cols; i++) {
    const x = (canvas.width / cols) * i;
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, canvas.height);
    ctx.stroke();
  }
}
</script>
